generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String           @id @default(cuid())
  email          String           @unique
  password       String
  name           String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  recipes        Recipe[]
  favorites      Recipe[]         @relation("UserFavorites")
  ingredients    Ingredient[] // Remove UserIngredient[] relation
  UserIngredient UserIngredient[]
  SavedItem      SavedItem[]
}

model Recipe {
  id           String             @id @default(cuid())
  title        String
  description  String
  instructions String
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  userId       String
  user         User               @relation(fields: [userId], references: [id])
  ingredients  RecipeIngredient[]
  favoritedBy  User[]             @relation("UserFavorites")
}

model RecipeIngredient {
  recipeId     String
  ingredientId String
  quantity     String
  recipe       Recipe     @relation(fields: [recipeId], references: [id])
  ingredient   Ingredient @relation(fields: [ingredientId], references: [id])

  @@id([recipeId, ingredientId])
}

model UserIngredient {
  userId       String
  ingredientId String
  quantity     String
  user         User   @relation(fields: [userId], references: [id])

  @@id([userId, ingredientId])
}

model Ingredient {
  id                String             @id @default(cuid())
  name              String
  quantity          String
  expiryDate        DateTime?
  purchaseDate      DateTime           @default(now())
  categoryId        String
  userId            String
  category          Category           @relation(fields: [categoryId], references: [id])
  user              User               @relation(fields: [userId], references: [id])
  recipeIngredients RecipeIngredient[]

  @@index([userId])
}

model Category {
  id          String       @id @default(cuid())
  name        String       @unique
  ingredients Ingredient[]
  SavedItem   SavedItem[]
}

model SavedItem {
  id         String   @id @default(cuid())
  name       String
  quantity   String
  category   Category @relation(fields: [categoryId], references: [id])
  categoryId String
  userId     String
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id])
}
